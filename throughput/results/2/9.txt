BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%midnight%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2748789982.00286
 ALGERIA                   |   1997 |  4690986294.0686
 ALGERIA                   |   1996 | 4693557496.45328
 ALGERIA                   |   1995 | 4691511813.16156
 ALGERIA                   |   1994 | 4679971174.99861
 ALGERIA                   |   1993 | 4674218105.24336
 ALGERIA                   |   1992 | 4699404396.79105
 ARGENTINA                 |   1998 |  2684237636.2355
 ARGENTINA                 |   1997 | 4628679571.77921
 ARGENTINA                 |   1996 | 4603406625.79971
 ARGENTINA                 |   1995 | 4589362806.86879
 ARGENTINA                 |   1994 | 4604112774.42482
 ARGENTINA                 |   1993 | 4618749648.72365
 ARGENTINA                 |   1992 | 4643118145.58777
 BRAZIL                    |   1998 | 2739033472.73929
 BRAZIL                    |   1997 | 4654930171.59951
 BRAZIL                    |   1996 | 4690289845.66635
 BRAZIL                    |   1995 | 4672965063.52894
 BRAZIL                    |   1994 | 4684877478.06879
 BRAZIL                    |   1993 | 4693149408.90692
 BRAZIL                    |   1992 | 4675562938.71849
 CANADA                    |   1998 | 2737432208.53032
 CANADA                    |   1997 | 4677185522.03992
 CANADA                    |   1996 | 4683994836.83634
 CANADA                    |   1995 | 4668033267.23487
 CANADA                    |   1994 | 4664066015.81211
 CANADA                    |   1993 | 4673489857.16084
 CANADA                    |   1992 | 4679964978.67414
 CHINA                     |   1998 | 2734265417.84014
 CHINA                     |   1997 | 4655675383.31502
 CHINA                     |   1996 | 4699326283.44234
 CHINA                     |   1995 | 4668412389.11887
 CHINA                     |   1994 | 4682606534.63262
 CHINA                     |   1993 | 4671738250.50413
 CHINA                     |   1992 | 4684343211.23449
 EGYPT                     |   1998 |  2705258797.3599
 EGYPT                     |   1997 | 4604929559.49936
 EGYPT                     |   1996 | 4653067048.14197
 EGYPT                     |   1995 | 4637812570.13445
 EGYPT                     |   1994 | 4645816618.09651
 EGYPT                     |   1993 | 4650110162.66582
 EGYPT                     |   1992 |  4666639499.7603
 ETHIOPIA                  |   1998 | 2737904144.09276
 ETHIOPIA                  |   1997 | 4676357365.64907
 ETHIOPIA                  |   1996 | 4695358885.59784
 ETHIOPIA                  |   1995 | 4681342071.81341
 ETHIOPIA                  |   1994 | 4704257518.95651
 ETHIOPIA                  |   1993 | 4678811122.70802
 ETHIOPIA                  |   1992 | 4708799869.00523
 FRANCE                    |   1998 | 2736920681.35774
 FRANCE                    |   1997 | 4690108235.60106
 FRANCE                    |   1996 | 4708450555.48037
 FRANCE                    |   1995 | 4692540754.58534
 FRANCE                    |   1994 | 4694086635.14462
 FRANCE                    |   1993 | 4676064282.02972
 FRANCE                    |   1992 | 4689826723.38082
 GERMANY                   |   1998 |  2743882122.2816
 GERMANY                   |   1997 | 4692807606.59303
 GERMANY                   |   1996 | 4690678914.37143
 GERMANY                   |   1995 | 4701149234.58872
 GERMANY                   |   1994 | 4689405888.80019
 GERMANY                   |   1993 | 4696552273.63348
 GERMANY                   |   1992 | 4706420234.42814
 INDIA                     |   1998 | 2734402901.47263
 INDIA                     |   1997 |  4657137291.1591
 INDIA                     |   1996 | 4682525883.54051
 INDIA                     |   1995 | 4641935533.22177
 INDIA                     |   1994 | 4660386544.85748
 INDIA                     |   1993 | 4658159677.12975
 INDIA                     |   1992 | 4679675975.36326
 INDONESIA                 |   1998 | 2727239784.23747
 INDONESIA                 |   1997 | 4616895283.56118
 INDONESIA                 |   1996 | 4649059753.99409
 INDONESIA                 |   1995 | 4621438550.02595
 INDONESIA                 |   1994 | 4634908971.61387
 INDONESIA                 |   1993 | 4649899830.21273
 INDONESIA                 |   1992 | 4647676364.81919
 IRAN                      |   1998 | 2729544519.08645
 IRAN                      |   1997 | 4645468276.94141
 IRAN                      |   1996 | 4683754547.58527
 IRAN                      |   1995 | 4664557492.72109
 IRAN                      |   1994 | 4668992122.07899
 IRAN                      |   1993 | 4638534716.85984
 IRAN                      |   1992 | 4665137802.32833
 IRAQ                      |   1998 |  2718009318.1288
 IRAQ                      |   1997 | 4625152820.45596
 IRAQ                      |   1996 | 4667043525.31278
 IRAQ                      |   1995 | 4635704491.84315
 IRAQ                      |   1994 | 4630286352.12258
 IRAQ                      |   1993 | 4615280780.20772
 IRAQ                      |   1992 | 4639215458.78427
 JAPAN                     |   1998 | 2712813736.27964
 JAPAN                     |   1997 |  4637451306.3049
 JAPAN                     |   1996 | 4656521727.18264
 JAPAN                     |   1995 | 4640660470.09392
 JAPAN                     |   1994 | 4653886064.47819
 JAPAN                     |   1993 | 4629910944.13105
 JAPAN                     |   1992 | 4651650037.09483
 JORDAN                    |   1998 | 2696025542.42748
 JORDAN                    |   1997 | 4631827164.51617
 JORDAN                    |   1996 | 4639013802.34865
 JORDAN                    |   1995 | 4621864341.21126
 JORDAN                    |   1994 | 4626522800.17231
 JORDAN                    |   1993 | 4603295842.63476
 JORDAN                    |   1992 | 4636503809.65524
 KENYA                     |   1998 | 2709244170.53109
 KENYA                     |   1997 | 4647835403.30948
 KENYA                     |   1996 | 4653127123.14269
 KENYA                     |   1995 | 4633882392.73224
 KENYA                     |   1994 | 4608502112.01517
 KENYA                     |   1993 | 4629439181.43922
 KENYA                     |   1992 | 4632160506.25913
 MOROCCO                   |   1998 | 2757614748.11962
 MOROCCO                   |   1997 | 4688314569.79662
 MOROCCO                   |   1996 | 4696021458.57217
 MOROCCO                   |   1995 | 4671430841.42436
 MOROCCO                   |   1994 |  4688648011.6991
 MOROCCO                   |   1993 | 4680277568.75965
 MOROCCO                   |   1992 | 4703701115.03386
 MOZAMBIQUE                |   1998 |  2715478988.4423
 MOZAMBIQUE                |   1997 | 4659787664.15099
 MOZAMBIQUE                |   1996 | 4666436723.25141
 MOZAMBIQUE                |   1995 | 4650875563.56173
 MOZAMBIQUE                |   1994 | 4660357519.50581
 MOZAMBIQUE                |   1993 | 4653699824.62891
 MOZAMBIQUE                |   1992 |  4648494136.0012
 PERU                      |   1998 |  2726609452.7298
 PERU                      |   1997 | 4638041397.24264
 PERU                      |   1996 | 4655507155.68827
 PERU                      |   1995 | 4667054991.35737
 PERU                      |   1994 | 4633515955.67771
 PERU                      |   1993 | 4647328458.94581
 PERU                      |   1992 | 4639991899.79959
 ROMANIA                   |   1998 | 2754955811.75623
 ROMANIA                   |   1997 | 4687988876.48874
 ROMANIA                   |   1996 | 4681320654.45955
 ROMANIA                   |   1995 | 4676925884.81524
 ROMANIA                   |   1994 | 4701703870.72351
 ROMANIA                   |   1993 | 4676539164.33931
 ROMANIA                   |   1992 | 4696192162.52364
 RUSSIA                    |   1998 | 2735389285.55655
 RUSSIA                    |   1997 | 4695066827.84144
 RUSSIA                    |   1996 | 4698408326.60523
 RUSSIA                    |   1995 | 4665521018.08829
 RUSSIA                    |   1994 | 4673537995.95744
 RUSSIA                    |   1993 | 4665739938.44946
 RUSSIA                    |   1992 | 4703513686.64121
 SAUDI ARABIA              |   1998 | 2728609937.43711
 SAUDI ARABIA              |   1997 | 4635404504.12708
 SAUDI ARABIA              |   1996 | 4661317052.61763
 SAUDI ARABIA              |   1995 | 4633653361.26913
 SAUDI ARABIA              |   1994 | 4664714800.51351
 SAUDI ARABIA              |   1993 |  4655805526.0843
 SAUDI ARABIA              |   1992 | 4648237478.11458
 UNITED KINGDOM            |   1998 | 2757216526.66053
 UNITED KINGDOM            |   1997 | 4703773098.85247
 UNITED KINGDOM            |   1996 | 4721991151.66313
 UNITED KINGDOM            |   1995 | 4732382556.05409
 UNITED KINGDOM            |   1994 | 4703535134.82484
 UNITED KINGDOM            |   1993 | 4667254914.75927
 UNITED KINGDOM            |   1992 | 4718651352.78908
 UNITED STATES             |   1998 | 2721644340.44775
 UNITED STATES             |   1997 | 4693662446.11855
 UNITED STATES             |   1996 | 4691337453.85508
 UNITED STATES             |   1995 | 4668394252.40098
 UNITED STATES             |   1994 | 4697622507.25933
 UNITED STATES             |   1993 | 4696464230.86262
 UNITED STATES             |   1992 |  4683087252.4872
 VIETNAM                   |   1998 | 2759920227.45674
 VIETNAM                   |   1997 | 4711708584.13195
 VIETNAM                   |   1996 |  4699068283.1976
 VIETNAM                   |   1995 | 4694468374.28826
 VIETNAM                   |   1994 | 4704821072.86865
 VIETNAM                   |   1993 | 4696325879.74959
 VIETNAM                   |   1992 |  4697241704.6453
(175 rows)

COMMIT;
COMMIT
