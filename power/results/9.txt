BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%peru%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2715478488.85518
 ALGERIA                   |   1997 | 4623605397.89628
 ALGERIA                   |   1996 | 4665974061.32093
 ALGERIA                   |   1995 | 4665925395.62935
 ALGERIA                   |   1994 | 4663459172.40429
 ALGERIA                   |   1993 | 4660957645.27554
 ALGERIA                   |   1992 | 4653446440.84228
 ARGENTINA                 |   1998 | 2721942983.36502
 ARGENTINA                 |   1997 | 4631284179.53952
 ARGENTINA                 |   1996 | 4677330788.56065
 ARGENTINA                 |   1995 | 4648681661.65582
 ARGENTINA                 |   1994 |  4639955109.6643
 ARGENTINA                 |   1993 | 4620785342.69338
 ARGENTINA                 |   1992 |  4635274830.2337
 BRAZIL                    |   1998 | 2739843961.45465
 BRAZIL                    |   1997 | 4697185810.69544
 BRAZIL                    |   1996 | 4706185627.49352
 BRAZIL                    |   1995 | 4700681056.64998
 BRAZIL                    |   1994 | 4664953226.12795
 BRAZIL                    |   1993 | 4664677635.03262
 BRAZIL                    |   1992 | 4685806754.36203
 CANADA                    |   1998 | 2766626366.51676
 CANADA                    |   1997 | 4709573401.73275
 CANADA                    |   1996 | 4709958111.70745
 CANADA                    |   1995 | 4697110950.68954
 CANADA                    |   1994 | 4712105844.21072
 CANADA                    |   1993 | 4727091669.19523
 CANADA                    |   1992 | 4710526881.42927
 CHINA                     |   1998 | 2734138469.58816
 CHINA                     |   1997 | 4654438481.09523
 CHINA                     |   1996 | 4675862377.48826
 CHINA                     |   1995 | 4651326158.08056
 CHINA                     |   1994 | 4658114161.18899
 CHINA                     |   1993 | 4645087857.40757
 CHINA                     |   1992 | 4675357329.50005
 EGYPT                     |   1998 | 2730937786.69713
 EGYPT                     |   1997 | 4676784303.94751
 EGYPT                     |   1996 | 4676986561.39757
 EGYPT                     |   1995 | 4661776166.88228
 EGYPT                     |   1994 | 4671103895.34768
 EGYPT                     |   1993 | 4654927536.63122
 EGYPT                     |   1992 | 4685803878.41533
 ETHIOPIA                  |   1998 | 2743331379.00494
 ETHIOPIA                  |   1997 | 4690973837.43567
 ETHIOPIA                  |   1996 | 4689785155.91611
 ETHIOPIA                  |   1995 |  4666691078.8844
 ETHIOPIA                  |   1994 | 4726367844.65689
 ETHIOPIA                  |   1993 | 4677390397.92616
 ETHIOPIA                  |   1992 |  4705189149.5238
 FRANCE                    |   1998 | 2739428849.94375
 FRANCE                    |   1997 | 4686673225.83885
 FRANCE                    |   1996 | 4685883367.40545
 FRANCE                    |   1995 | 4701973897.49924
 FRANCE                    |   1994 | 4690132264.00601
 FRANCE                    |   1993 | 4674065843.66727
 FRANCE                    |   1992 | 4698954708.97916
 GERMANY                   |   1998 | 2772410092.49636
 GERMANY                   |   1997 | 4710089776.91015
 GERMANY                   |   1996 | 4714205961.34167
 GERMANY                   |   1995 | 4707921241.55351
 GERMANY                   |   1994 | 4692065201.21105
 GERMANY                   |   1993 | 4699423410.76811
 GERMANY                   |   1992 | 4695697098.01386
 INDIA                     |   1998 | 2750770854.73229
 INDIA                     |   1997 | 4688372913.82872
 INDIA                     |   1996 | 4673768582.06088
 INDIA                     |   1995 | 4684763907.03625
 INDIA                     |   1994 | 4696569949.24682
 INDIA                     |   1993 | 4687905797.93441
 INDIA                     |   1992 | 4711505328.48674
 INDONESIA                 |   1998 | 2737589215.24367
 INDONESIA                 |   1997 | 4648562367.25292
 INDONESIA                 |   1996 | 4656345980.00973
 INDONESIA                 |   1995 | 4639993126.02876
 INDONESIA                 |   1994 | 4646896379.78579
 INDONESIA                 |   1993 | 4625468970.84751
 INDONESIA                 |   1992 | 4657451408.37967
 IRAN                      |   1998 | 2748767100.53786
 IRAN                      |   1997 | 4649270067.87794
 IRAN                      |   1996 | 4663481145.15512
 IRAN                      |   1995 | 4646470695.49922
 IRAN                      |   1994 | 4632094198.71633
 IRAN                      |   1993 | 4647629260.15998
 IRAN                      |   1992 | 4677473689.86884
 IRAQ                      |   1998 | 2721695109.44599
 IRAQ                      |   1997 | 4647570615.30089
 IRAQ                      |   1996 | 4653551293.37336
 IRAQ                      |   1995 | 4614586770.68589
 IRAQ                      |   1994 | 4638384640.08736
 IRAQ                      |   1993 | 4624729234.73594
 IRAQ                      |   1992 | 4645041152.30082
 JAPAN                     |   1998 | 2727940038.67299
 JAPAN                     |   1997 | 4625728063.17561
 JAPAN                     |   1996 | 4659983584.54498
 JAPAN                     |   1995 | 4640415938.15263
 JAPAN                     |   1994 | 4630603713.07092
 JAPAN                     |   1993 |  4616270815.7777
 JAPAN                     |   1992 | 4664424061.00164
 JORDAN                    |   1998 | 2746373534.32517
 JORDAN                    |   1997 | 4624694338.14618
 JORDAN                    |   1996 | 4662426278.06478
 JORDAN                    |   1995 | 4654053359.20707
 JORDAN                    |   1994 | 4651505350.26392
 JORDAN                    |   1993 |  4676061162.9338
 JORDAN                    |   1992 |  4664116817.9942
 KENYA                     |   1998 | 2699504778.09135
 KENYA                     |   1997 | 4621134432.39032
 KENYA                     |   1996 | 4642071169.40258
 KENYA                     |   1995 | 4603214141.91548
 KENYA                     |   1994 | 4614474564.68924
 KENYA                     |   1993 | 4623141514.31027
 KENYA                     |   1992 |  4621745216.7628
 MOROCCO                   |   1998 | 2750117923.36449
 MOROCCO                   |   1997 | 4678594207.74977
 MOROCCO                   |   1996 | 4712896806.03134
 MOROCCO                   |   1995 | 4643148313.20291
 MOROCCO                   |   1994 | 4656738146.21166
 MOROCCO                   |   1993 | 4677951173.05029
 MOROCCO                   |   1992 | 4683112608.41012
 MOZAMBIQUE                |   1998 | 2726826831.69248
 MOZAMBIQUE                |   1997 | 4620233849.26541
 MOZAMBIQUE                |   1996 | 4662285144.23821
 MOZAMBIQUE                |   1995 | 4647163254.14238
 MOZAMBIQUE                |   1994 | 4659163897.62977
 MOZAMBIQUE                |   1993 | 4653573518.78387
 MOZAMBIQUE                |   1992 | 4666137657.67378
 PERU                      |   1998 | 2717759442.43597
 PERU                      |   1997 | 4613318645.34626
 PERU                      |   1996 |  4643391462.7423
 PERU                      |   1995 | 4649403203.40788
 PERU                      |   1994 | 4642638883.50156
 PERU                      |   1993 | 4625268546.96143
 PERU                      |   1992 | 4649440184.67823
 ROMANIA                   |   1998 | 2745345884.33212
 ROMANIA                   |   1997 | 4702246402.78293
 ROMANIA                   |   1996 | 4717420545.54961
 ROMANIA                   |   1995 | 4685098028.75046
 ROMANIA                   |   1994 |  4688642123.3739
 ROMANIA                   |   1993 | 4686793565.00074
 ROMANIA                   |   1992 | 4680245023.05426
 RUSSIA                    |   1998 | 2723488478.14538
 RUSSIA                    |   1997 | 4666480859.86235
 RUSSIA                    |   1996 | 4685366338.71364
 RUSSIA                    |   1995 |  4669183226.6926
 RUSSIA                    |   1994 | 4662037357.64384
 RUSSIA                    |   1993 | 4656807010.23022
 RUSSIA                    |   1992 | 4678296251.12327
 SAUDI ARABIA              |   1998 |  2728182058.8575
 SAUDI ARABIA              |   1997 | 4638976126.38609
 SAUDI ARABIA              |   1996 | 4672228795.91289
 SAUDI ARABIA              |   1995 | 4621643501.85637
 SAUDI ARABIA              |   1994 | 4656622197.36059
 SAUDI ARABIA              |   1993 | 4642872423.33619
 SAUDI ARABIA              |   1992 | 4680025008.77123
 UNITED KINGDOM            |   1998 | 2754573803.19901
 UNITED KINGDOM            |   1997 | 4701723135.59435
 UNITED KINGDOM            |   1996 | 4700419970.53309
 UNITED KINGDOM            |   1995 | 4690401951.43574
 UNITED KINGDOM            |   1994 | 4691265490.54485
 UNITED KINGDOM            |   1993 | 4680490354.02276
 UNITED KINGDOM            |   1992 | 4686871056.43175
 UNITED STATES             |   1998 | 2742439171.88104
 UNITED STATES             |   1997 | 4666343030.07623
 UNITED STATES             |   1996 | 4684351802.16088
 UNITED STATES             |   1995 | 4667922488.22531
 UNITED STATES             |   1994 | 4656735422.93393
 UNITED STATES             |   1993 | 4689720812.85469
 UNITED STATES             |   1992 | 4681582411.86672
 VIETNAM                   |   1998 |  2745806801.6351
 VIETNAM                   |   1997 | 4693696642.98287
 VIETNAM                   |   1996 | 4709430830.96025
 VIETNAM                   |   1995 | 4708065675.92467
 VIETNAM                   |   1994 | 4692822600.97487
 VIETNAM                   |   1993 | 4696201028.61333
 VIETNAM                   |   1992 | 4718857844.51313
(175 rows)

COMMIT;
COMMIT
